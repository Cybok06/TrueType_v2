<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tax Management | TrueType Services</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://res.cloudinary.com/dl2ipzxyk/image/upload/v1751107241/logo_ijmteg.avif" type="image/png">

  <!-- UI libs -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Front-end PDF libs -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <style>
    body { background:#f6f8fb; }
    .navbar-brand img { height: 36px; }
    .summary-card { border-radius: 12px; background:#fff; box-shadow: 0 6px 18px rgba(0,0,0,.06); padding: 18px; }
    .summary-card h6 { color:#6c757d; margin-bottom:.25rem }
    .summary-card .big { font-weight: 700; font-size: 1.35rem; }
    .omc-card { border-radius: 12px; background:#fff; box-shadow: 0 6px 18px rgba(0,0,0,.06); padding: 16px; }
    .section-card { border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    .table thead th { white-space: nowrap; }
    .filter-chip { background:#eef2ff; color:#3b82f6; border-radius:999px; padding:.25rem .6rem; font-size:.8rem; }
    .btn-icon { display:flex; align-items:center; gap:.4rem; }
    .muted-kv { font-size:.85rem; color:#6c757d; }
    .muted-kv .v { color:#111; font-weight:600; }
    .pill { border-radius:999px; padding:.15rem .5rem; font-size:.8rem; }
    .pill-info { background:#edf2ff; color:#3b5bdb; }
    .pill-warn { background:#fff4e6; color:#d9480f; }
    .pill-ok { background:#e6fcf5; color:#0ca678; }
  </style>
</head>
<body>
<nav class="navbar navbar-light bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="#">
      <img src="https://res.cloudinary.com/dl2ipzxyk/image/upload/v1751107241/logo_ijmteg.avif" alt="Logo">
      <span class="fw-semibold d-none d-sm-inline">TrueType Services</span>
    </a>
  </div>
</nav>

<div class="container py-4">

  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
    <h3 class="text-primary m-0"><i class="bi bi-receipt-cutoff me-2"></i> S-Tax Management</h3>
    <div class="d-flex gap-2">
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addTaxModal">
        <i class="bi bi-plus-circle me-1"></i> Add Other Tax
      </button>
    </div>
  </div>

  <!-- Summary -->
  <div class="row g-3 mb-4">
    <div class="col-sm-6 col-lg-3">
      <div class="summary-card">
        <h6>Total Paid (filtered)</h6>
        <div class="big">GHâ‚µ {{ total_paid_sum }}</div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-3">
      <div class="summary-card">
        <h6>Unpaid P-Tax (Sum)</h6>
        <div class="big">GHâ‚µ {{ total_unpaid_sum }}</div>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="summary-card">
        <h6 class="mb-2"><i class="bi bi-graph-up-arrow me-1"></i> Monthly Payments</h6>
        <canvas id="taxTrendChart" height="56"></canvas>
      </div>
    </div>
  </div>

  <!-- OMC cards -->
  {% if omc_cards and omc_cards|length > 0 %}
  <div class="mb-4">
    <div class="d-flex align-items-center justify-content-between">
      <h6 class="text-muted mb-2">Totals per OMC</h6>
      <button id="exportPdfAllCards" type="button" class="btn btn-outline-danger btn-sm btn-icon">
        <i class="bi bi-filetype-pdf"></i> Export Paid (All)
      </button>
    </div>
    <div class="row g-3">
      {% for c in omc_cards %}
      {% if c.total > 0 %}
      <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
        <div class="omc-card h-100">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="fw-semibold">{{ c.omc }}</div>
              <div class="text-muted small">Total Paid</div>
            </div>
            <button class="btn btn-sm btn-outline-secondary btn-icon export-omc" type="button"
                    data-omc="{{ c.omc }}">
              <i class="bi bi-filetype-pdf"></i> PDF
            </button>
          </div>
          <div class="fs-5 fw-bold mt-2">GHâ‚µ {{ c.total_fmt }}</div>
        </div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Unpaid -->
  <div class="card section-card mb-4">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="m-0"><i class="bi bi-exclamation-circle text-warning me-2"></i>Unpaid P-Tax Orders</h5>
        <span class="text-muted small">Due = P-tax per L Ã— quantity</span>
      </div>

      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th>OMC</th>
              <th>Order ID</th>
              <th class="text-end">Quantity</th>
              <th class="text-end">S-Tax / L (GHâ‚µ)</th>
              <th class="text-end">Due Amount (GHâ‚µ)</th>
              <th>Status</th>
              <th class="text-end">Action</th>
            </tr>
          </thead>
          <tbody>
            {% if unpaid_rows %}
              {% for r in unpaid_rows %}
              <tr>
                <td class="fw-semibold">{{ r.omc }}</td>
                <td>{{ r.order_id }}</td>
                <td class="text-end">{{ r.quantity_fmt }}</td>
                <td class="text-end">{{ r.s_price_fmt }}</td>
                <td class="text-end">GHâ‚µ {{ r.due_amount_fmt }}</td>
                <td>
                  <span class="badge text-bg-{{ r.payment_badge }}">{{ r.payment_status }}</span>
                </td>
                <td class="text-end">
                  <!-- NOTE: data-paid defaults to 0 for now; once backend adds it, the live balance will use it -->
                  <button class="btn btn-primary btn-sm"
                          data-order-oid="{{ r._id }}"
                          data-order-id="{{ r.order_id }}"
                          data-omc="{{ r.omc }}"
                          data-due="{{ r.due_amount_fmt }}"
                          data-paid="{{ r.already_paid_fmt or '0.00' }}"
                          data-bs-toggle="modal"
                          data-bs-target="#payModal">
                    <i class="bi bi-cash-coin me-1"></i> Pay / Top-up
                  </button>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="7" class="text-center text-muted py-4">
                  <i class="bi bi-check2-circle me-1"></i>All P-Tax orders are paid. ðŸŽ‰
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Paid (inline) -->
  <div class="card section-card">
    <div class="card-body">
      <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2">
        <h5 class="m-0"><i class="bi bi-journal-check me-2"></i>Paid P-Tax</h5>
        <div class="d-flex align-items-center gap-2">
          <div class="filter-chip">Current total (filtered): <strong>GHâ‚µ {{ total_paid_sum }}</strong></div>
          <button id="exportPdfFiltered" type="button" class="btn btn-outline-danger btn-sm btn-icon">
            <i class="bi bi-filetype-pdf"></i> Export PDF (Filtered)
          </button>
        </div>
      </div>

      <!-- Filters -->
      <form class="row gy-2 gx-2 align-items-end mb-3" method="get" action="/tax" id="filtersForm">
        <div class="col-12 col-md-3">
          <label class="form-label mb-1">OMC</label>
          <select name="omc" class="form-select">
            <option value="">All OMCs</option>
            {% if omc_cards %}
              {% for c in omc_cards %}
                <option value="{{ c.omc }}" {% if filters.omc == c.omc %}selected{% endif %}>{{ c.omc }}</option>
              {% endfor %}
            {% endif %}
          </select>
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label mb-1">Paid By</label>
          <input type="text" class="form-control" name="paid_by" value="{{ filters.paid_by }}" placeholder="Name / part of name">
        </div>
        <div class="col-6 col-md-2">
          <label class="form-label mb-1">From</label>
          <input type="date" class="form-control" name="date_from" value="{{ filters.date_from }}">
        </div>
        <div class="col-6 col-md-2">
          <label class="form-label mb-1">To</label>
          <input type="date" class="form-control" name="date_to" value="{{ filters.date_to }}">
        </div>
        <div class="col-6 col-md-1">
          <label class="form-label mb-1">Min</label>
          <input type="number" step="0.01" class="form-control" name="amount_min" value="{{ filters.amount_min }}">
        </div>
        <div class="col-6 col-md-1">
          <label class="form-label mb-1">Max</label>
          <input type="number" step="0.01" class="form-control" name="amount_max" value="{{ filters.amount_max }}">
        </div>
        <div class="col-12 d-flex flex-wrap gap-2 mt-1">
          <button class="btn btn-primary"><i class="bi bi-funnel me-1"></i> Apply Filters</button>
          <a class="btn btn-outline-secondary" href="/tax"><i class="bi bi-arrow-counterclockwise me-1"></i> Reset</a>
        </div>
      </form>

      <!-- Paid table -->
      <div class="table-responsive">
        <table id="paidTable" class="table table-striped align-middle">
          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>OMC</th>
              <th>Order ID</th>
              <th class="text-end">Amount (GHâ‚µ)</th>
              <th>Reference</th>
              <th>Paid By</th>
            </tr>
          </thead>
          <tbody>
            {% if paid_rows %}
              {% for p in paid_rows %}
              <tr>
                <td data-col="date">{{ p.payment_date_str }}</td>
                <td data-col="omc">{{ p.omc }}</td>
                <td data-col="order_id">{{ p.order_id }}</td>
                <td data-col="amount" class="text-end">GHâ‚µ {{ p.amount_fmt }}</td>
                <td data-col="reference">{{ p.reference }}</td>
                <td data-col="paid_by">{{ p.paid_by }}</td>
              </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="6" class="text-center text-muted py-4">No S-Tax payments match your filters.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- Chart data -->
<script id="trend-data" type="application/json">
  {{ trend_data | tojson }}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // ===== Chart =====
  (function() {
    const trendEl = document.getElementById("trend-data");
    const trendObj = trendEl ? JSON.parse(trendEl.textContent || "{}") : {};
    const labels = Object.keys(trendObj || {});
    const values = Object.values(trendObj || {});
    if (labels.length) {
      new Chart(document.getElementById('taxTrendChart').getContext('2d'), {
        type: 'line',
        data: { labels, datasets: [{ label: 'Tax Paid (GHâ‚µ)', data: values, borderColor: '#0d6efd', backgroundColor: 'rgba(13,110,253,.08)', fill: true, tension: 0.35, pointRadius: 3 }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }
  })();

  // ===== Helpers for PDF =====
  const logoURL = "https://res.cloudinary.com/dl2ipzxyk/image/upload/v1751107241/logo_ijmteg.avif";

  function loadLogoDataURL(url) {
    return new Promise((resolve) => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = function () {
        const canvas = document.createElement("canvas");
        const h = 40; // px target height in PDF
        const ratio = h / img.naturalHeight;
        canvas.width = img.naturalWidth * ratio;
        canvas.height = h;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        resolve(canvas.toDataURL("image/png"));
      };
      img.onerror = () => resolve(null);
      img.src = url;
    });
  }

  function parseMoney(str) {
    if (!str) return 0;
    const n = String(str).replace(/[^\d.-]/g, "");
    const v = Number(n);
    return Number.isFinite(v) ? v : 0;
  }

  function toMoney(n) {
    return Number(n || 0).toLocaleString("en-GH", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  }

  function getPaidRowsFromDOM(filterOMC = "") {
    const rows = [];
    const trs = document.querySelectorAll("#paidTable tbody tr");
    trs.forEach(tr => {
      const tds = tr.querySelectorAll("td");
      if (!tds || tds.length < 6) return; // skip empty message row
      const date = tds[0].textContent.trim();
      const omc = tds[1].textContent.trim();
      const orderId = tds[2].textContent.trim();
      const amountTxt = tds[3].textContent.trim();
      const reference = tds[4].textContent.trim();
      const paidBy = tds[5].textContent.trim();
      if (filterOMC && omc !== filterOMC) return;
      rows.push({
        date, omc, orderId, reference, paidBy,
        amount: parseMoney(amountTxt)
      });
    });
    return rows;
  }

  async function exportPaidPDF({ filterOMC = "", titleSuffix = "" } = {}) {
    const rows = getPaidRowsFromDOM(filterOMC);
    if (!rows.length) {
      alert("No paid records to export for the selected scope.");
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ orientation: "landscape", unit: "pt", format: "A4" });

    // Header
    const logo = await loadLogoDataURL(logoURL);
    const pageWidth = doc.internal.pageSize.getWidth();
    let x = 40, y = 40;
    if (logo) doc.addImage(logo, "PNG", x, y - 10, 80, 40);

    doc.setFont("Helvetica", "bold");
    doc.setFontSize(14);
    doc.text("TrueType Services", logo ? x + 90 : x, y);
    doc.setFont("Helvetica", "normal");
    doc.setFontSize(11);
    let title = "P-Tax Payments Report";
    if (filterOMC) title += ` â€” ${filterOMC}`;
    if (titleSuffix) title += ` ${titleSuffix}`;
    doc.text(title, x, y + 18);
    doc.setFontSize(9);
    doc.text(`Generated: ${new Date().toISOString().slice(0,16).replace("T"," ")} UTC`, pageWidth - 200, y + 18);

    // Table data
    const head = [["Date", "OMC", "Order ID", "Amount (GHâ‚µ)", "Reference", "Paid By"]];
    const body = rows.map(r => [r.date, r.omc, r.orderId, toMoney(r.amount), r.reference, r.paidBy]);

    const total = rows.reduce((s, r) => s + (r.amount || 0), 0);

    doc.autoTable({
      head,
      body,
      startY: y + 32,
      theme: "striped",
      styles: { font: "Helvetica", fontSize: 9, cellPadding: 6, overflow: "linebreak" },
      headStyles: { fillColor: [33, 37, 41], textColor: [255,255,255] },
      columnStyles: {
        0: { cellWidth: 90 },
        1: { cellWidth: 170 },
        2: { cellWidth: 90 },
        3: { halign: "right", cellWidth: 110 },
        4: { cellWidth: 220 },
        5: { cellWidth: 110 },
      },
      didDrawPage: function () {
        const pageCount = doc.getNumberOfPages();
        const str = `Page ${doc.internal.getCurrentPageInfo().pageNumber} of ${pageCount}`;
        doc.setFontSize(9);
        doc.text(str, pageWidth - 70, doc.internal.pageSize.getHeight() - 20);
      }
    });

    // Total row
    const finalY = doc.lastAutoTable.finalY || (y + 32);
    doc.setFont("Helvetica", "bold");
    doc.text(`TOTAL: GHâ‚µ ${toMoney(total)}`, pageWidth - 180, finalY + 24);

    const filename = filterOMC ? `P_tax_paid_${filterOMC.replace(/\W+/g,'_').toLowerCase()}.pdf`
                               : "P_tax_paid_filtered.pdf";
    doc.save(filename);
  }

  // Export buttons
  document.getElementById("exportPdfFiltered")?.addEventListener("click", () => {
    const f = Object.fromEntries(new FormData(document.getElementById("filtersForm")).entries());
    let bits = [];
    if (f.omc) bits.push(`OMC: ${f.omc}`);
    if (f.paid_by) bits.push(`Paid by: ${f.paid_by}`);
    if (f.date_from || f.date_to) bits.push(`Date: ${f.date_from || 'â€¦'} â†’ ${f.date_to || 'â€¦'}`);
    if (f.amount_min || f.amount_max) bits.push(`Amt: ${f.amount_min || 'â€¦'} â†’ ${f.amount_max || 'â€¦'}`);
    const suffix = bits.length ? `(${bits.join(" | ")})` : "";
    exportPaidPDF({ titleSuffix: suffix });
  });

  document.querySelectorAll(".export-omc").forEach(btn => {
    btn.addEventListener("click", () => {
      const omc = btn.getAttribute("data-omc");
      exportPaidPDF({ filterOMC: omc });
    });
  });

  document.getElementById("exportPdfAllCards")?.addEventListener("click", () => exportPaidPDF());

  // ===== Pay modal wiring (partial-pay enabled) =====
  const payModal = document.getElementById('payModal');
  const remainBadge = () => document.getElementById('pay-remaining-badge');
  const paidBadge = () => document.getElementById('pay-paid-badge');
  const dueBadge = () => document.getElementById('pay-due-badge');

  function computeRemaining(due, alreadyPaid, thisPay) {
    const left = Math.max(0, (due - alreadyPaid) - thisPay);
    return left;
  }

  function updateBadges() {
    const due = parseFloat(document.getElementById('pay-due').value || '0');
    const alreadyPaid = parseFloat(document.getElementById('pay-already').value || '0');
    const thisPay = parseFloat(document.getElementById('pay-amount').value || '0');
    const rem = computeRemaining(due, alreadyPaid, thisPay);

    dueBadge().textContent = `Due: GHâ‚µ ${toMoney(due)}`;
    paidBadge().textContent = `Already paid: GHâ‚µ ${toMoney(alreadyPaid)}`;
    remainBadge().textContent = `Remaining after this: GHâ‚µ ${toMoney(rem)}`;

    // Color based on remaining
    remainBadge().classList.remove('pill-ok','pill-warn');
    remainBadge().classList.add(rem === 0 ? 'pill-ok' : 'pill-warn');
  }

  if (payModal) {
    payModal.addEventListener('show.bs.modal', function (ev) {
      const btn = ev.relatedTarget;
      const dueTxt = (btn.getAttribute('data-due') || '0').replace(/,/g,'');
      const paidTxt = (btn.getAttribute('data-paid') || '0').replace(/,/g,'');

      document.getElementById('pay-order-oid').value = btn.getAttribute('data-order-oid');
      document.getElementById('pay-order-id').value = btn.getAttribute('data-order-id');
      document.getElementById('pay-omc').value = btn.getAttribute('data-omc');
      document.getElementById('pay-due').value = parseMoney(dueTxt).toFixed(2);
      document.getElementById('pay-already').value = parseMoney(paidTxt).toFixed(2);

      // Default to outstanding as the suggested amount (can be edited for partial)
      const outstanding = Math.max(0, parseMoney(dueTxt) - parseMoney(paidTxt));
      document.getElementById('pay-amount').value = outstanding.toFixed(2);

      const today = new Date().toISOString().slice(0,10);
      document.getElementById('pay-date').value = today;

      updateBadges();
    });
  }

  // Amount changes => live remaining
  document.getElementById('pay-amount')?.addEventListener('input', updateBadges);

  // ===== Submit forms (partial pay â€“ backend will be adjusted) =====
  const payForm = document.getElementById("pay-form");
  if (payForm) {
    payForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const fd = new FormData(e.target);

      // Allow any amount > 0
      const amount = parseFloat(fd.get("amount") || "0");
      if (!(amount > 0)) {
        alert("Amount must be greater than 0");
        return;
      }

      fetch("/tax/pay", { method: "POST", body: fd })
        .then(r => r.json())
        .then(data => {
          if (data.status === "success") {
            const modalEl = document.getElementById("payModal");
            bootstrap.Modal.getInstance(modalEl).hide();
            document.querySelectorAll(".modal-backdrop").forEach(el => el.remove());
            if (typeof loadContent === "function") { loadContent("/tax"); } else { location.reload(); }
          } else {
            alert("Error: " + (data.message || "Payment failed"));
          }
        })
        .catch(err => { console.error(err); alert("Submission failed."); });
    });
  }

  const addForm = document.getElementById("tax-form");
  if (addForm) {
    addForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const fd = new FormData(addForm);
      const sel = document.getElementById("type-select");
      if (sel.value.toLowerCase() === "other") {
        fd.set("type", document.getElementById("custom-type-input").value.trim());
      }
      fetch("/tax/add", { method: "POST", body: fd })
        .then(r => r.json())
        .then(data => {
          if (data.status === "success") {
            bootstrap.Modal.getInstance(document.getElementById("addTaxModal")).hide();
            document.querySelectorAll(".modal-backdrop").forEach(el => el.remove());
            if (typeof loadContent === "function") { loadContent("/tax"); } else { location.reload(); }
          } else {
            alert("Error: " + (data.message || "Failed to add tax"));
          }
        })
        .catch(err => { console.error(err); alert("Submission failed."); });
    });
  }
</script>

<!-- Record S-Tax Payment Modal (now supports partial) -->
<div class="modal fade" id="payModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="pay-form" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Record P-Tax Payment (Partial Allowed)</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body row g-2">
        <input type="hidden" name="order_oid" id="pay-order-oid">
        <input type="hidden" id="pay-due">
        <input type="hidden" id="pay-already">

        <div class="col-12">
          <div class="d-flex flex-wrap gap-2">
            <span id="pay-due-badge" class="pill pill-info">Due: GHâ‚µ 0.00</span>
            <span id="pay-paid-badge" class="pill pill-info">Already paid: GHâ‚µ 0.00</span>
            <span id="pay-remaining-badge" class="pill pill-warn">Remaining after this: GHâ‚µ 0.00</span>
          </div>
        </div>

        <div class="col-12"><label class="form-label">OMC</label><input type="text" class="form-control" id="pay-omc" readonly></div>
        <div class="col-6"><label class="form-label">Order ID</label><input type="text" class="form-control" id="pay-order-id" readonly></div>
        <div class="col-6"><label class="form-label">Payment Date</label><input type="date" class="form-control" name="payment_date" id="pay-date" required></div>

        <div class="col-6">
          <label class="form-label">Amount (GHâ‚µ)</label>
          <input type="number" step="0.01" class="form-control" name="amount" id="pay-amount" required>
          <div class="form-text">Partial payment allowed. Remaining will stay as balance.</div>
        </div>

        <div class="col-6">
          <label class="form-label">Reference (Receipt/Txn ID)</label>
          <input type="text" class="form-control" name="reference" id="pay-ref" placeholder="e.g. RCPT-12345">
        </div>

        <div class="col-12">
          <label class="form-label">Paid By</label>
          <input type="text" class="form-control" name="paid_by" id="pay-by" required>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" type="submit">
          <i class="bi bi-check2-circle me-1"></i> Save Payment
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Add Other Tax -->
<div class="modal fade" id="addTaxModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="tax-form" class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Add Tax Record</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body row g-2">
        <div class="col-12"><label class="form-label">Type of Tax</label>
          <select class="form-select" name="type" id="type-select" required>
            <option value="">-- Select --</option>
            <option>Income Tax</option><option>VAT</option><option>SSNIT</option><option>Corporate Tax</option><option value="Other">Other</option>
          </select>
        </div>
        <div class="col-12" id="other-type-input" style="display:none">
          <label class="form-label">Enter Custom Tax Type</label>
          <input type="text" class="form-control" id="custom-type-input" placeholder="e.g. Local Levy">
        </div>
        <div class="col-6"><label class="form-label">Amount (GHâ‚µ)</label><input type="number" step="0.01" class="form-control" name="amount" required></div>
        <div class="col-6"><label class="form-label">Payment Date</label><input type="date" class="form-control" name="payment_date" required></div>
        <div class="col-6"><label class="form-label">Reference / Proof</label><input type="text" class="form-control" name="reference"></div>
        <div class="col-6"><label class="form-label">Paid By</label><input type="text" class="form-control" name="paid_by" required></div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button class="btn btn-primary" type="submit">Add Tax</button></div>
    </form>
  </div>
</div>
</body>
</html>
 
